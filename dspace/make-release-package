#!/bin/sh

USAGE="$0 cvs-tag version"

# Just in case you need to 'socksify' etc
CVS_COMMAND="cvs"

# Check we have command-line arguments
if [ "$#" != "2" ]; then
        echo $USAGE
        exit 1
fi

FILENAME="dspace-$2-source"


mkdir tmp
cd tmp

echo "Checking out core code..."
$CVS_COMMAND -q export -r $1 dspace

# Don't need to include this script!
rm -f dspace/make-release-package

# Or silly cvsignore file
rm -f dspace/.cvsignore

# get rid of silly GPL'd METS stuff
#rm -f dspace/src/org/dspace/app/mets/METSExport.java

echo "Creating tarball..."
mv dspace $FILENAME

tar -cf - $FILENAME | gzip -c > $FILENAME.tar.gz

echo "Cleaning up..."

cd ..
mv tmp/$FILENAME.tar.gz .
rm -r tmp

echo "Package created as $FILENAME.tar.gz"
